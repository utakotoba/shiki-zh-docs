---
outline: deep
---

# Shiki v2.0.0

Shiki v2.0.0 æœ¬èº«æ˜¯ä¸€ä¸ª**å¹³æ·¡æ— å¥‡**çš„ç‰ˆæœ¬ã€‚

å¦‚æœä½ é”™è¿‡äº†ï¼Œæˆ‘ä»¬åœ¨å°ç‰ˆæœ¬æ›´æ–°ä¸­é€æ­¥å¼•å…¥äº†ä¸€äº›éå¸¸é…·çš„æ–°åŠŸèƒ½ï¼š

| ç‰ˆæœ¬                                                             | å€¼å¾—æ³¨æ„çš„æ–°åŠŸèƒ½                                                                                                                       |
| ---------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| [v1.1.0](https://github.com/shikijs/shiki/releases/tag/v1.1.0)   | æ›´å¥½çš„ Twoslash æ”¯æŒ                                                                                                                   |
| [v1.3.0](https://github.com/shikijs/shiki/releases/tag/v1.3.0)   | æ–°å¢ `structure: inline` é€‰é¡¹                                                                                                          |
| [v1.6.0](https://github.com/shikijs/shiki/releases/tag/v1.6.0)   | ä½œç”¨åŸŸé¢œè‰²æ›¿æ¢ï¼Œæ„Ÿè°¢ [@QuentinRoy](https://github.com/QuentinRoy)                                                                      |
| [v1.8.0](https://github.com/shikijs/shiki/releases/tag/v1.8.0)   | æš´éœ² `.dispose()` æ–¹æ³•ç”¨äºæ˜¾å¼èµ„æºæ¸…ç†                                                                                                 |
| [v1.10.0](https://github.com/shikijs/shiki/releases/tag/v1.10.0) | å¼•å…¥äº† [Grammar State](/guide/grammar-state) ç”¨äºéƒ¨åˆ†ä»£ç é«˜äº®                                                                          |
| [v1.15.0](https://github.com/shikijs/shiki/releases/tag/v1.15.0) | å¼•å…¥äº† [JavaScript Engine](/guide/regex-engines#javascript-engine)ï¼Œå…·æœ‰æ›´å¥½çš„å¯ç§»æ¤æ€§å’Œæ›´å°çš„åŒ…ä½“ç§¯                                   |
| [v1.16.0](https://github.com/shikijs/shiki/releases/tag/v1.16.0) | æ”¯æŒ [åŒæ­¥ä½¿ç”¨](/guide/sync-usage)                                                                                                     |
| [v1.19.0](https://github.com/shikijs/shiki/releases/tag/v1.19.0) | å¼•å…¥äº† `enableDeprecationWarnings()` å‡½æ•°ä»¥ä¾¿äºè¿ç§»ã€‚æ”¯æŒå¯¹è±¡é£æ ¼çš„ `htmlStyle` å’Œæ–°çš„ `htmlAttrs` ä¸»é¢˜åŒ– tokenã€‚                      |
| [v1.23.0](https://github.com/shikijs/shiki/releases/tag/v1.23.0) | æ–°å¢ [`@shikijs/colorized-brackets`](/packages/colorized-brackets) åŒ…ï¼Œæ„Ÿè°¢ [@MichaelMakesGames](https://github.com/MichaelMakesGames) |
| [v1.24.0](https://github.com/shikijs/shiki/releases/tag/v1.24.0) | æ”¹è¿›äº† JavaScript å¼•æ“çš„æ€§èƒ½å’Œå‡†ç¡®æ€§ï¼Œæ„Ÿè°¢ [@slevithan](https://github.com/slevithan)                                                  |
| [v1.25.0](https://github.com/shikijs/shiki/releases/tag/v1.25.0) | å°†ä¸»é¢˜å’Œè¯­è¨€åˆ†ç¦»åˆ° `@shikijs/themes` å’Œ `@shikijs/languages` åŒ…ä¸­                                                                      |
| [v1.26.0](https://github.com/shikijs/shiki/releases/tag/v1.26.0) | å¼•å…¥äº† [é¢„ç¼–è¯‘è¯­è¨€](https://shiki.style/guide/regex-engines#pre-compiled-languages) åŒ…ï¼Œä»¥å‡å°‘åŒ…ä½“ç§¯å¹¶æé«˜æ€§èƒ½                         |
| [v1.27.0](https://github.com/shikijs/shiki/releases/tag/v1.27.0) | æ–°å¢ [`shiki-codegen`](/packages/codegen) åŒ…ï¼Œä¾¿äºç»†ç²’åº¦çš„åŒ…åˆ›å»º                                                                       |
| [v1.29.0](https://github.com/shikijs/shiki/releases/tag/v1.28.0) | æ”¹è¿›äº† transformer åŒ¹é…ç®—æ³•ï¼Œå¼•å…¥ `matchAlgorithm` é€‰é¡¹ã€‚æ„Ÿè°¢ [@fuma-nama](https://github.com/fuma-nama)                               |

åœ¨è¿™äº›æ–°åŠŸèƒ½ä¸­ï¼Œæˆ‘ä»¬è¿˜å¢åŠ äº†è®¸å¤šæ–°è¯­è¨€æ”¯æŒå’Œæ–°çš„ä¸»é¢˜ã€‚æŸ¥çœ‹ [è¯­è¨€](/languages) å’Œ [ä¸»é¢˜](/themes) åˆ—è¡¨ä»¥è·å–å®Œæ•´åˆ—è¡¨ã€‚

åŒæ—¶ï¼Œéå¸¸æ„Ÿè°¢ [@slevithan](https://github.com/slevithan) åœ¨ [`oniguruma-to-es`](https://github.com/slevithan/oniguruma-to-es) ä¸Šçš„å‡ºè‰²å·¥ä½œï¼Œä½¿å¾— JavaScript å¼•æ“ [æ”¯æŒ 97.2% çš„æ‰€æœ‰è¯­è¨€](/references/engine-js-compat)ã€‚

## ç ´åæ€§å˜æ›´

åœ¨ v2.0.0 ä¸­**æ²¡æœ‰**ç¡¬æ€§çš„ç ´åæ€§å˜æ›´ã€‚å®ƒä½œä¸ºå³å°†åˆ°æ¥çš„ v3.0.0 çš„å«è„šçŸ³ã€‚

v2 ä¸­å”¯ä¸€çš„å˜åŒ–æ˜¯ï¼ŒShiki ç°åœ¨ä¼šåœ¨ä½ ä½¿ç”¨è®¡åˆ’åœ¨ v3 ä¸­ç§»é™¤çš„åºŸå¼ƒ API æ—¶**å‘å‡ºè­¦å‘Š**ã€‚ç”±äºè¿™å¯èƒ½ä¼šå½±å“æœ€ç»ˆç”¨æˆ·ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ä¸»ç‰ˆæœ¬å‡çº§ï¼Œä»¥ä¾¿ä½ å¯ä»¥é€‰æ‹©å¯ç”¨è­¦å‘Šå¹¶ä¸ºæœªæ¥çš„ç§»é™¤åšå¥½å‡†å¤‡ã€‚

- `v1.x`ï¼šåºŸå¼ƒçš„ API ä»ç„¶æ”¯æŒï¼Œä»…åœ¨ç±»å‹çº§åˆ«æ ‡è®°ã€‚å¯é€‰æ‹©å¯ç”¨è¿è¡Œæ—¶è­¦å‘Šã€‚
- ğŸ‘‰ `v2.0`ï¼šæ²¡æœ‰ç ´åæ€§å˜æ›´ï¼Œä½†é»˜è®¤å¯ç”¨è¿è¡Œæ—¶åºŸå¼ƒè­¦å‘Šã€‚
- `v3.0`ï¼šç§»é™¤åºŸå¼ƒçš„ APIï¼Œç ´åæ€§å˜æ›´ã€‚

é¢„è®¡ v3.0.0 å°†åœ¨ v2.0.0 ä¹‹åä¸ä¹…å‘å¸ƒã€‚

## è‡ªåŠ¨åŒ–è¿ç§»

ä¸ºäº†å¸®åŠ©è¿ç§»è¿‡ç¨‹ï¼Œç¤¾åŒºæˆå‘˜ [Covolute](https://covolute.com/registry/shiki/v1-to-v2) æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–ä»£ç ä¿®æ”¹å·¥å…·ï¼Œå¤„ç†äº†ä» v1 åˆ° v2 çš„å¤§éƒ¨åˆ† API å˜æ›´ã€‚ä½ å¯ä»¥ç›´æ¥è¿è¡Œï¼š

```bash
npx covolute@latest shiki/v1-to-v2
```

## åºŸå¼ƒå†…å®¹

æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½ å°½å¿«è¿ç§»åºŸå¼ƒå†…å®¹ï¼Œå¹¶ä»¥è­¦å‘Šä¿¡æ¯ä¸ºæŒ‡å—ã€‚

### `getHighlighter` -> `createHighlighter`

æ²¡æœ‰åŠŸèƒ½ä¸Šçš„å˜åŒ–ï¼Œæ›´åƒæ˜¯çº æ­£å‘½åä»¥é¿å…æ··æ·†ã€‚åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥æ‰¾å’Œæ›¿æ¢æ“ä½œã€‚

### WASM ç›¸å…³ API

è‡ªä»åœ¨ v1.16 å¼•å…¥ [å¼•æ“ç³»ç»Ÿ](/guide/regex-engines) ä»¥æ¥ï¼ŒWebAssembly ç›¸å…³çš„ä¾èµ–ä¸å†æ˜¯ç¡¬æ€§è¦æ±‚ã€‚ä¸ºäº†ä¾¿äº tree-shaking å¹¶å°†å¼•æ“ä¸æ ¸å¿ƒè§£è€¦ï¼Œä¸¤ä¸ªåŒ…è¢«æå–å‡ºæ¥ï¼š`@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript`ã€‚è¿™äº›ä¹Ÿä»ä¸»åŒ…ä¸­é‡æ–°å¯¼å‡ºä¸º `shiki/engine/oniguruma` å’Œ `shiki/engine/javascript`ã€‚

ä½ å¯èƒ½éœ€è¦æ›´æ”¹å¯¼å…¥è·¯å¾„ï¼š

```ts
import { loadWasm } from 'shiki' // [!code --]
import { loadWasm } from 'shiki/engine/oniguruma' // [!code ++]
```

`createHighlighterCore` ä¸­çš„ `loadWasm` å­—æ®µè¢«æ›¿æ¢ä¸º `engine` å­—æ®µï¼š

```ts
import { createHighlighter } from 'shiki'
import { createOnigurumaEngine } from 'shiki/engine/oniguruma' // [!code ++]
const shiki = await createHighlighter({
  // ...
  loadWasm: () => import('shiki/wasm'), // [!code --]
  engine: createOnigurumaEngine(() => import('shiki/wasm')), // [!code ++]
})
```

### Shiki å…¼å®¹åŒ…

ä¸ºä¸ v0.14 å…¼å®¹è€Œæ„å»ºçš„ `@shikijs/compat` åŒ…ç°å·²åºŸå¼ƒã€‚è¯·è¿ç§»åˆ°ä¸»åŒ…ã€‚è¯¥åŒ…å°†åœ¨ v3.0 ä¸­ç§»é™¤ã€‚

### Transformer åŒ¹é…ç®—æ³•

`matchAlgorithm` é€‰é¡¹åœ¨ v1.29.0 ä¸­å¼•å…¥ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©åŒ¹é…ç®—æ³•ã€‚é»˜è®¤å€¼å°†åœ¨ v3.0.0 ä¸­ä» `v1` æ›´æ”¹ä¸º `v3`ã€‚æˆ‘ä»¬å»ºè®®æ˜¾å¼è®¾ç½® `matchAlgorithm` é€‰é¡¹ä»¥é¿å…æœªæ¥çš„ç ´åæ€§å˜æ›´ã€‚

[äº†è§£æ›´å¤š](/packages/transformers#matching-algorithm)ã€‚

### å…¶ä»–åºŸå¼ƒå†…å®¹

- `createdBundledHighlighter` éœ€è¦å•ä¸ªå¯¹è±¡é£æ ¼çš„å‚æ•°
- `@shikijs/core`
  - æ­£åˆ™å¼•æ“ `createJavaScriptRegexEngine` å’Œ `createOnigurumaEngine` ä¸å†åŒ…å«åœ¨å†…ï¼Œåˆ†åˆ«ä» `@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript` å¯¼å…¥
  - `createHighlighterCore` ç°åœ¨æ˜ç¡®è¦æ±‚ä¼ é€’ `engine` å­—æ®µ
  - `createHighlighterCore` ä¸­çš„ `loadWasm` å­—æ®µè¢«æ›¿æ¢ä¸º `engine` å­—æ®µ
  - `@shikijs/core/wasm-inline` è¢«æ›¿æ¢ä¸º `@shikijs/engine-oniguruma/wasm-inline`
  - ä» `@shikijs/vscode-textmate` å¯¼å…¥ `FontStyle` å’Œ `StackElementMetadata`ï¼Œè€Œä¸æ˜¯ `@shikijs/core`

## è°ƒæ•´è­¦å‘Š

å¦‚æœä½ æ›´å–œæ¬¢ç¡¬é”™è¯¯è€Œä¸æ˜¯è­¦å‘Šï¼Œå¯ä»¥åœ¨ä½¿ç”¨ Shiki ä¹‹å‰è¿è¡Œä»¥ä¸‹ä»£ç ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å†³å®šæ˜¯å¦å¯ç”¨è­¦å‘Šï¼Œç¬¬äºŒä¸ªå‚æ•°å†³å®šæ˜¯å¦å°†è­¦å‘Šä½œä¸ºé”™è¯¯æŠ›å‡ºï¼š

```ts
import { enableDeprecationWarnings } from 'shiki/core'

enableDeprecationWarnings(true, true) // å¯ç”¨è­¦å‘Šå¹¶æŠ›å‡ºé”™è¯¯

// ä¹‹åä½¿ç”¨ crateHighlighter(...) ç­‰
```

### ç¦ç”¨è­¦å‘Š

å¦‚æœä½ æƒ³ç¦ç”¨è­¦å‘Šï¼š

```ts
import { enableDeprecationWarnings } from 'shiki/core'

enableDeprecationWarnings(false)
```

## ä½œä¸ºç”¨æˆ·å°è¯•

å¦‚æœä½ é€šè¿‡å…¶ä»–åŒ…é—´æ¥ä½¿ç”¨ Shikiï¼Œæ¯”å¦‚ [`vitepress`](https://vitepress.dev/) æˆ– [`@nuxt/content`](https://content.nuxt.com/)ï¼Œå¹¶ä¸”ä½ æ— æ³•ç›´æ¥æ§åˆ¶ Shiki çš„ç‰ˆæœ¬ï¼Œä½ å¯ä»¥å°è¯•åœ¨ `package.json` ä¸­æ·»åŠ ä»¥ä¸‹è¡Œæ¥å¼ºåˆ¶ä½¿ç”¨ Shiki v2.0.0ã€‚è¿™å°†å¸®åŠ©ä½ æ£€æŸ¥ä½ ä½¿ç”¨çš„æ¡†æ¶/å·¥å…·æ˜¯å¦ä¾èµ–äºåºŸå¼ƒçš„ Shiki APIã€‚å¦‚æœæ˜¯ï¼Œè¯·å‘ä»–ä»¬çš„ä»“åº“æŠ¥å‘Šï¼Œä»¥æé«˜å¯¹å³å°†åˆ°æ¥çš„å˜æ›´çš„è®¤è¯†ã€‚è°¢è°¢ï¼

```json
{
  "resolutions": {
    "shiki": "^2",
    "@shikijs/core": "^2",
    "@shikijs/transformers": "^2",
    "@shikijs/markdown-it": "^2",
    "@shikijs/rehype": "^2"
  }
}
```

## åé¦ˆ

æ¬¢è¿ä»»ä½•åé¦ˆï¼è¯·éšæ—¶åœ¨ [GitHub](https://github.com/shikijs/shiki) ä¸Šæå‡ºé—®é¢˜ï¼Œå‘Šè¯‰æˆ‘ä»¬ä½ çš„æƒ³æ³•ã€‚
