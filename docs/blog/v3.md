---
outline: deep
---

# Shiki v3.0.0

Shiki v3.0.0 æ˜¯ä¸€ä¸ª**å¹³æ·¡æ— å¥‡**çš„ç‰ˆæœ¬ï¼ˆä¸[å‰ä¸€ä¸ªç‰ˆæœ¬](./v2)ç›¸æ¯”ï¼‰ï¼Œå®ƒç§»é™¤äº†è‡ª v1.x ç‰ˆæœ¬èµ·å·²æ ‡è®°ä¸ºå¼ƒç”¨ï¼Œå¹¶åœ¨ v2.x ç‰ˆæœ¬ä¸­æ˜ç¡®è­¦å‘Šçš„ APIã€‚

åœ¨ Shiki ä¸­ï¼Œæ–°åŠŸèƒ½ä¼šé€æ­¥åœ¨å°ç‰ˆæœ¬ä¸­å‘å¸ƒï¼Œè€Œä¸»ç‰ˆæœ¬åˆ™ç”¨äºæ¸…ç†å’Œåˆ é™¤å¼ƒç”¨çš„ APIã€‚

å¦‚æœä½ ä»åœ¨ä½¿ç”¨ v1.x ç‰ˆæœ¬ï¼Œè¯·å…ˆ[è¿ç§»åˆ° v2.x ç‰ˆæœ¬](./v2)ã€‚å®ƒåº”è¯¥ä¸ºä½ æä¾›ä¸€ä¸ªå¹³æ»‘çš„è¿‡æ¸¡åˆ° v3.0.0 çš„è·¯å¾„ã€‚

## ç ´åæ€§å˜æ›´

- `v1.x`: å¼ƒç”¨çš„ API ä»ç„¶å—æ”¯æŒï¼Œä»…åœ¨ç±»å‹å±‚é¢æ ‡è®°ã€‚å¯ä»¥é€‰æ‹©å¯ç”¨è¿è¡Œæ—¶è­¦å‘Šã€‚
- `v2.0`: æ²¡æœ‰ç ´åæ€§å˜æ›´ï¼Œä½†é»˜è®¤å¯ç”¨è¿è¡Œæ—¶å¼ƒç”¨è­¦å‘Šã€‚
- ğŸ‘‰ `v3.0`: ç§»é™¤å¼ƒç”¨çš„ APIï¼Œç ´åæ€§å˜æ›´ã€‚

### `getHighlighter` -> `createHighlighter`

æ²¡æœ‰åŠŸèƒ½ä¸Šçš„å˜åŒ–ï¼Œæ›´åƒæ˜¯ä¿®æ­£äº†å‘½åï¼Œä»¥é¿å…æ··æ·†ã€‚è¿™åº”è¯¥æ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥æ‰¾å’Œæ›¿æ¢ã€‚

### WASM ç›¸å…³ API

è‡ªä» v1.16 ç‰ˆæœ¬å¼•å…¥[å¼•æ“ç³»ç»Ÿ](/guide/regex-engines)ä»¥æ¥ï¼Œä¸ WebAssembly ç›¸å…³çš„ä¾èµ–ä¸å†æ˜¯ç¡¬æ€§è¦æ±‚ã€‚ä¸ºäº†æ–¹ä¾¿ tree-shaking å¹¶å°†å¼•æ“ä¸æ ¸å¿ƒè§£è€¦ï¼Œæˆ‘ä»¬æå–äº†ä¸¤ä¸ªåŒ…ï¼š`@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript`ã€‚å®ƒä»¬ä¹Ÿä»ä¸»åŒ…ä¸­é‡æ–°å¯¼å‡ºï¼Œåˆ†åˆ«ä¸º `shiki/engine/oniguruma` å’Œ `shiki/engine/javascript`ã€‚

ä½ å¯èƒ½éœ€è¦æ›´æ”¹ä½ çš„å¯¼å…¥è·¯å¾„ï¼š

```ts
import { loadWasm } from 'shiki' // [!code --]
import { loadWasm } from 'shiki/engine/oniguruma' // [!code ++]
```

`createHighlighterCore` ä¸­çš„ `loadWasm` å­—æ®µè¢«æ›¿æ¢ä¸º `engine` å­—æ®µï¼š

```ts
import { createHighlighter } from 'shiki'
import { createOnigurumaEngine } from 'shiki/engine/oniguruma' // [!code ++]
const shiki = await createHighlighter({
  // ...
  loadWasm: () => import('shiki/wasm'), // [!code --]
  engine: createOnigurumaEngine(() => import('shiki/wasm')), // [!code ++]
})
```

åŒæ—¶ï¼Œ`@shikijs/core` åŒ…ä¸å†åŒ…å«å¼•æ“æˆ– wasm äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ä½ éœ€è¦ä» `@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript` åŒ…ä¸­å¯¼å…¥å®ƒä»¬ã€‚

### Shiki Compat

ä¸ºå…¼å®¹ v0.14 è€Œæ„å»ºçš„ `@shikijs/compat` åŒ…ç°å·²åœæ­¢ç»´æŠ¤ã€‚è¯·è¿ç§»åˆ°ä¸»åŒ…ã€‚

### è½¬æ¢å™¨åŒ¹é…ç®—æ³•

è½¬æ¢å™¨çš„ `matchAlgorithm` é€‰é¡¹åœ¨ v1.29.0 ä¸­å¼•å…¥ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©åŒ¹é…ç®—æ³•ã€‚v3.0.0 ä¸­ï¼Œé»˜è®¤å€¼ä» `v1` æ›´æ”¹ä¸º `v3`ã€‚

[äº†è§£æ›´å¤š](/packages/transformers#matching-algorithm)ã€‚

### å…¶ä»–ç ´åæ€§å˜æ›´

- `createdBundledHighlighter` éœ€è¦ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡é£æ ¼å‚æ•°ã€‚
- `@shikijs/core`
  - æ­£åˆ™è¡¨è¾¾å¼å¼•æ“ `createJavaScriptRegexEngine` `createOnigurumaEngine` ä¸å†åŒ…å«ï¼Œè¯·åˆ†åˆ«ä» `@shikijs/engine-oniguruma` å’Œ `@shikijs/engine-javascript` å¯¼å…¥å®ƒä»¬ã€‚
  - `@shikijs/core/wasm-inline` è¢« `@shikijs/engine-oniguruma/wasm-inline` æ›¿æ¢ã€‚
  - ä» `@shikijs/vscode-textmate` è€Œä¸æ˜¯ `@shikijs/core` å¯¼å…¥ `FontStyle` å’Œ `StackElementMetadata`ã€‚

## ç”¨æˆ·è¯•ç”¨

å¦‚æœä½ é—´æ¥é€šè¿‡å…¶ä»–åŒ…ï¼ˆä¾‹å¦‚ [`vitepress`](<[https://vitepress.dev/](https://vitepress.dev/)>) æˆ– [`@nuxt/content`](<[https://content.nuxt.com/](https://content.nuxt.com/)>)ï¼‰ä½¿ç”¨ Shikiï¼Œè€Œä½ æ— æ³•ç›´æ¥æ§åˆ¶ Shiki çš„ç‰ˆæœ¬ï¼Œåˆ™å¯ä»¥å°è¯•åœ¨ä½ çš„ `package.json` ä¸­æ·»åŠ ä»¥ä¸‹è¡Œï¼Œä»¥å¼ºåˆ¶ä½¿ç”¨ [Shiki v2.0.0](./v2)ã€‚

```json
{
  "resolutions": {
    "shiki": "^2",
    "@shikijs/core": "^2",
    "@shikijs/transformers": "^2",
    "@shikijs/markdown-it": "^2",
    "@shikijs/rehype": "^2"
  }
}
```

ç„¶åè¿è¡Œè¯¥å·¥å…·ï¼Œçœ‹çœ‹æ˜¯å¦å‘å‡ºä»»ä½•è­¦å‘Šã€‚å¦‚æœå‘å‡ºè­¦å‘Šï¼Œè¯·å°†å…¶æŠ¥å‘Šç»™å®ƒä»¬çš„ä»“åº“ï¼Œä»¥å¼•èµ·äººä»¬å¯¹å³å°†åˆ°æ¥çš„æ›´æ”¹çš„æ³¨æ„ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¯¥å·¥å…·åº”è¯¥ä¸ Shiki v3.0.0 ä¸€èµ·æŒ‰é¢„æœŸå·¥ä½œï¼Œä½ å¯ä»¥è¿›ä¸€æ­¥è¿ç§»åˆ° v3ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```json
{
  "resolutions": {
    "shiki": "^3",
    "@shikijs/core": "^3",
    "@shikijs/transformers": "^3",
    "@shikijs/markdown-it": "^3",
    "@shikijs/rehype": "^3"
  }
}
```

## åé¦ˆ

æ¬¢è¿ä»»ä½•åé¦ˆï¼è¯·éšæ—¶åœ¨ [GitHub](https://github.com/shikijs/shiki) ä¸Šæå‡º issueï¼Œè®©æˆ‘ä»¬çŸ¥é“ä½ çš„æƒ³æ³•ã€‚
